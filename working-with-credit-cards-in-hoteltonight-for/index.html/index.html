
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Working With Credit Cards In HotelTonight For iPad - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="If you haven&rsquo;t heard, we released an iPad app. It&rsquo;s pretty good too. We were confronted with quite a few interesting and unique &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://raylillywhite.github.com/raylillywhitehtblog/working-with-credit-cards-in-hoteltonight-for/">
  <link href="/raylillywhitehtblog/favicon.png" rel="icon">
  <link href="/raylillywhitehtblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/raylillywhitehtblog/javascripts/modernizr-2.0.js"></script>
  <script src="/raylillywhitehtblog/javascripts/ender.js"></script>
  <script src="/raylillywhitehtblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/raylillywhitehtblog/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:raylillywhite.github.com/raylillywhitehtblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/raylillywhitehtblog/">Blog</a></li>
  <li><a href="/raylillywhitehtblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Working With Credit Cards in HotelTonight for iPad</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-03T00:00:00-07:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you haven&rsquo;t heard, we <a href="http://itunes.apple.com/us/app/hotel-tonight-last-minute/id407690035?mt=8">released an iPad app</a>. It&rsquo;s pretty good too. We were confronted with quite a few interesting and unique challenges in bringing our iPhone app to the much larger screen of the iPad. Just blowing everything up so that the existing phone app used the entirety of the iPad&rsquo;s screen wasn&rsquo;t good enough. We needed to start with a blank slate and rebuild everything from scratch to make a true iPad experience that we could be proud of.</p>

<p>One area that received quite a bit of attention was the interface for entering and selecting a credit card to use during a booking. Since we sell a physical good (a hotel room reservation), we don&rsquo;t use the in-app purchase frameworks that Apple provides for allowing upgrades and other purchases in the other apps you love.</p>

<p>The problem with credit card input is that no one enjoys doing it. It&rsquo;s a utilitarian chore entering a string of numbers, an expiration date and a CVV whether you&rsquo;re on the desktop or mobile. Our primary goal with creating this new card entry experience was to make it not only easy to use, but also fun.</p>

<p>For comparisons sake, this is what we started with on the iPhone:</p>

<p><img src="http://getfile0.posterous.com/getfile/files.posterous.com/temp-2012-04-03/xGawDAvBDvsJtshiyatAHecrDBByEEoomozeyAnkknelEycjgmlfovgtvAqh/iphone_cards.png" alt="iPhone Card Entry" /></p>

<p>Certainly a serviceable UI, but not something that we wanted to just import into the iPad UI. For one, having a full size table view in the middle of our booking workflow would look strangely out of place. Second, we tried really hard to minimize the number of popovers in the interface. Popovers are useful for supplemental information, but providing them as part of the main workflow in the app wouldn&rsquo;t be a fit for the experience we were trying to provide our users.</p>

<h2>Research/Inspiration</h2>

<p>Before we went down the path of building our own card implementation, we spent some time downloading different mobile apps and seeing how they did credit card entry. The first place to look of course is at our friends at <a href="http://squareup.com">Square</a>. A company built around taking mobile payments is an easy place to look. We also were incredibly impressed by our same day booking buddies at <a href="https://www.getwillcall.com/">WillCall</a>. Their entire app is impressive, but their card entry UI is what caught our eye the most.</p>

<p>What both Square and WillCall have in common is the single-line entry paradigm. Once you enter a credit card number, your cursor automatically shifts to the next field, followed by the next until you&rsquo;re ready to submit. There is inline validation along the way to ensure the user isn&rsquo;t hitting the authentication servers with obviously bad data such as an expired card or an invalid card number.</p>

<h2>What We Ended Up With</h2>

<p>For the first version of HotelTonight for iPad, this is what we shipped:</p>

<p><img src="http://getfile9.posterous.com/getfile/files.posterous.com/temp-2012-04-03/avozleyDqeElcedGGsahpcEbfvFpvggDnpjkEAdwGGqIEJpeweIjnqtGIDDa/card1.png" alt="Card Entry State" /></p>

<p>There are three states to our card selection user interface:</p>

<ol>
<li>The card entry state (above)</li>
<li>The card validation state (below)</li>
<li>The card selection state (the screenshot below that).</li>
</ol>


<p>The card entry state has two fields: the card number and card expiration. The card number field is just a vanilla <code>UITextField</code>, but we do a bit of massaging of the input as the user types. Most noteably, we have a <code>UITextFieldTextDidChangeNotification</code> handler attached that does three things:</p>

<ol>
<li>Ensure that we have a valid length card number</li>
<li>Ensure that the card number matches the type of cards we support: Visa, MasterCard, American Express and Discover.</li>
<li>Ensure the card passes a <a href="http://en.wikipedia.org/wiki/Luhn_algorithm">luhn validation</a></li>
</ol>


<p>If the card number is validated, we automatically transition the user to the expiration date field so they can continue typing. No need to tap a next button or manually tap on the expiration field. Upon entering a successful expiration date, we transition to the  validation state.</p>

<p><img src="http://getfile4.posterous.com/getfile/files.posterous.com/temp-2012-04-03/CDtAFgCwzpGjHudBsCpmwErjAcaAhgonFxpuvsfepidhxIxafaJJGwDgmsJD/card2.png" alt="Card Validation State" /></p>

<p>The validation state transition is where we highlight what type of card the user has entered as well as providing the last four digits of their card number. Tapping on either of those transitions back to the card entry state. The user can also backspace from the CVV field to get back there. More on that later.</p>

<p>Once a card is entered, it shows in in our credit card tray.</p>

<p><img src="http://getfile9.posterous.com/getfile/files.posterous.com/temp-2012-04-03/BGydlczksqviHpqIvpnJDFrgztHtyAjFHoeAaxvvtJqAbbfqHejDsCFyhrjj/card3.png" alt="Card Selection State" /></p>

<p>The currently selected card has a full-color treatment while the others are desaturated. If you have more than a few cards, the picker turns into a scrollable control that lets you choose between the different ones.</p>

<h2>The Little Details</h2>

<p>We obsess over the little details at HT. The first time we played with a functional implementation of the card picker control, we were annoyed that deleting the last character in a text field didn&rsquo;t push back to the previous text field or picker state. It turns out this isn&rsquo;t as easy as we had hoped.</p>

<p>Whenever you make a change to a <code>UITextField</code>, you have the opportunity to perform an action using the <code>- textField:shouldChangeCharactersInRange:replacementString:</code> delegate method. Unfortunately it is not called if there are no characters in a text field. To work around this, we decided to insert a zero width space (\u200B for the Unicode fans in the house) at the beginning of each text field. <code>UITextField</code> won&rsquo;t render the space, but it is capable of being deleted, and subsequently firing our delegate method. We then check if the delete key is being pressed while the text field only contains that zero width space. If it is, we transition to the previous field.</p>

<h2>Things We Waffled Over</h2>

<p>In the run-up to shipping our shiny new iPad app, we gave everyone in the office an opportunity to test out the application. Tests like this are always eye opening because developer eyes tend to glaze over after staring at the same piece of functionality for days and weeks on end. We miss stuff, or assume other things are more obvious than they really are.</p>

<p>The first thing our user tests uncovered was that people didn&rsquo;t know what to do with the card picker in its default selection state if they didn&rsquo;t have any cards already associated with their account. To alleviate this, we default to showing the picker to the user in its card entry state if there are no credit cards associated with the currently logged in user.</p>

<p>We also decided to add a bit of help text underneath each the entry fields to further guide the user along. Each text field has placeholder text, but in the case of fields like CVV we were concerned some users might not know what a CVV was. The help text offers a bit of guidance.</p>

<h2>Moving Forward</h2>

<p>As with all things software, we have a few ideas of how we want to enhance the card picker going forward. For one, users can&rsquo;t currently edit or delete cards. There are also some additional treatments and animations we&rsquo;d like to add to the card tray as you transition from the selection state into the new card input.</p>

<p>You can check out the  card picker in action by downloading our new iPad app <a href="itunes">on the App Store</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2012-04-03T00:00:00-07:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://raylillywhite.github.com/raylillywhitehtblog/working-with-credit-cards-in-hoteltonight-for/index.html" data-via="" data-counturl="http://raylillywhite.github.com/raylillywhitehtblog/working-with-credit-cards-in-hoteltonight-for/index.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/raylillywhitehtblog/101696463/index.html" title="Previous Post: Mobile Apps Permissions - What to Do?">&laquo; Mobile Apps Permissions - What to Do?</a>
      
      
        <a class="basic-alignment right" href="/raylillywhitehtblog/writing-android-unit-tests-with-robolectric/index.html" title="Next Post: Writing Android Unit-Tests With Robolectric">Writing Android Unit-Tests With Robolectric &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/raylillywhitehtblog/blog/2013/02/18/the-nitty-gritty-of-ios-internationalization-and-localization/">The Nitty Gritty of iOS Internationalization and Localization</a>
      </li>
    
      <li class="post">
        <a href="/raylillywhitehtblog/lets-stop-making-our-users-type-gmailcom/index.html">Let's stop making our users type @gmail.com</a>
      </li>
    
      <li class="post">
        <a href="/raylillywhitehtblog/174411869/index.html">Internationalization and localization - Rails</a>
      </li>
    
      <li class="post">
        <a href="/raylillywhitehtblog/internationalization-and-localization-plannin/index.html">Internationalization and localization - Planning, tools, and process</a>
      </li>
    
      <li class="post">
        <a href="/raylillywhitehtblog/asynchronous-state-aware-component-rasterizat/index.html">State-aware cached rasterization in iOS for epic performance</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
